<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Emotional Intelligence - Animal Guides</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #2D5556;
      --secondary: #6C8FA4;
      --accent: #F0C7A0;
      --background: #1A1A2E;
      --surface: #16213E;
      --text: #FFFFFF;
      --success: #4CAF50;
      --error: #FF5252;
      
      /* Animal colors */
      --elephant-blue: #4A90D9;
      --dolphin-yellow: #FFD93D;
      --owl-purple: #9B59B6;
      --dog-green: #27AE60;
      --parrot-orange: #E67E22;
      --tiger-black: #2C3E50;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--background);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .game-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 20px;
    }
    
    .timer {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transition: width 0.5s ease;
    }
    
    .scene {
      display: none;
      flex-direction: column;
      flex: 1;
      animation: fadeIn 0.5s ease;
    }
    
    .scene.active {
      display: flex;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Intro Screen */
    .intro-screen {
      text-align: center;
      padding: 40px 20px;
    }
    
    .intro-screen h1 {
      font-size: 2rem;
      margin-bottom: 16px;
      background: linear-gradient(135deg, var(--accent), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .intro-screen p {
      color: rgba(255,255,255,0.7);
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    .animal-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin: 32px 0;
    }
    
    .animal-preview {
      background: var(--surface);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    
    .animal-emoji {
      font-size: 2.5rem;
      margin-bottom: 8px;
    }
    
    .animal-name {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .start-btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 16px 48px;
      font-size: 1.1rem;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 24px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(45, 85, 86, 0.4);
    }
    
    /* Scene Content */
    .scene-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .animal-badge {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    
    .scene-info h2 {
      font-size: 1.25rem;
      margin-bottom: 4px;
    }
    
    .scene-info .emotion {
      font-size: 0.875rem;
      color: var(--accent);
    }
    
    .scenario-card {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border-left: 4px solid;
    }
    
    .scenario-card h3 {
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 12px;
    }
    
    .scenario-card p {
      line-height: 1.7;
      font-size: 1rem;
    }
    
    .cue-strip {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      margin-top: 16px;
    }
    
    .color-badge {
      width: 24px;
      height: 24px;
      border-radius: 50%;
    }
    
    .phrase {
      font-style: italic;
      color: rgba(255,255,255,0.7);
    }
    
    .task-card {
      background: rgba(240, 199, 160, 0.1);
      border: 1px solid var(--accent);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
    }
    
    .task-card h4 {
      color: var(--accent);
      margin-bottom: 8px;
      font-size: 0.875rem;
      text-transform: uppercase;
    }
    
    .choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .choice {
      background: var(--surface);
      border: 2px solid transparent;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    
    .choice:hover {
      border-color: rgba(255,255,255,0.2);
    }
    
    .choice.selected {
      border-color: var(--accent);
      background: rgba(240, 199, 160, 0.1);
    }
    
    .choice.correct {
      border-color: var(--success);
      background: rgba(76, 175, 80, 0.1);
    }
    
    .choice.incorrect {
      border-color: var(--error);
      background: rgba(255, 82, 82, 0.1);
    }
    
    .choice-letter {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .choice.selected .choice-letter {
      background: var(--accent);
      color: var(--background);
    }
    
    .submit-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 16px;
      font-size: 1rem;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      margin-top: 16px;
      transition: all 0.2s;
      opacity: 0.5;
      pointer-events: none;
    }
    
    .submit-btn.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .submit-btn.active:hover {
      background: var(--secondary);
    }
    
    .feedback-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 100;
    }
    
    .feedback-modal.show {
      display: flex;
    }
    
    .feedback-content {
      background: var(--surface);
      border-radius: 20px;
      padding: 32px;
      max-width: 400px;
      text-align: center;
      animation: popIn 0.3s ease;
    }
    
    @keyframes popIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    .feedback-icon {
      font-size: 4rem;
      margin-bottom: 16px;
    }
    
    .feedback-content h3 {
      font-size: 1.5rem;
      margin-bottom: 12px;
    }
    
    .feedback-content p {
      color: rgba(255,255,255,0.7);
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    .next-btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 14px 32px;
      font-size: 1rem;
      border-radius: 10px;
      cursor: pointer;
    }
    
    /* Results Screen */
    .results-screen {
      text-align: center;
      padding: 40px 20px;
    }
    
    .results-icon {
      font-size: 5rem;
      margin-bottom: 24px;
    }
    
    .results-screen h2 {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    
    .proficiency-badge {
      display: inline-block;
      padding: 8px 24px;
      border-radius: 20px;
      font-weight: bold;
      margin-bottom: 32px;
    }
    
    .proficiency-badge.mastery {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
    }
    
    .proficiency-badge.proficient {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
    }
    
    .proficiency-badge.needs-work {
      background: linear-gradient(135deg, #FF5722, #E64A19);
    }
    
    .score-card {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }
    
    .score-value {
      font-size: 3rem;
      font-weight: bold;
      background: linear-gradient(135deg, var(--accent), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .score-label {
      color: rgba(255,255,255,0.6);
      margin-top: 4px;
    }
    
    .sub-results {
      display: flex;
      flex-direction: column;
      gap: 12px;
      text-align: left;
      margin-top: 24px;
    }
    
    .sub-result {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }
    
    .sub-result .emoji {
      font-size: 1.5rem;
    }
    
    .sub-result .name {
      flex: 1;
      font-size: 0.875rem;
    }
    
    .sub-result .status {
      font-size: 1.25rem;
    }
    
    .xp-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #9945FF, #14F195);
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: bold;
      margin-top: 24px;
    }
    
    .restart-btn {
      background: var(--surface);
      border: 2px solid var(--primary);
      color: white;
      padding: 14px 32px;
      font-size: 1rem;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 16px;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header" id="header" style="display: none;">
      <span class="scene-counter">Scene <span id="currentScene">1</span>/6</span>
      <span class="timer" id="timer">3:00</span>
    </div>
    
    <div class="progress-bar" id="progressBar" style="display: none;">
      <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>
    
    <!-- INTRO SCREEN -->
    <div class="scene active" id="intro">
      <div class="intro-screen">
        <h1>üß† Emotional Intelligence</h1>
        <h2 style="color: var(--accent); margin-bottom: 24px;">Animal Guides Validator</h2>
        <p>Test your analytical thinking through 6 emotional scenarios. Each scene features an animal guide representing a core emotion.</p>
        
        <div class="animal-grid">
          <div class="animal-preview">
            <div class="animal-emoji">üêò</div>
            <div class="animal-name">Elephant</div>
          </div>
          <div class="animal-preview">
            <div class="animal-emoji">üê¨</div>
            <div class="animal-name">Dolphin</div>
          </div>
          <div class="animal-preview">
            <div class="animal-emoji">ü¶â</div>
            <div class="animal-name">Owl</div>
          </div>
          <div class="animal-preview">
            <div class="animal-emoji">üêï</div>
            <div class="animal-name">Dog</div>
          </div>
          <div class="animal-preview">
            <div class="animal-emoji">ü¶ú</div>
            <div class="animal-name">Parrot</div>
          </div>
          <div class="animal-preview">
            <div class="animal-emoji">üêØ</div>
            <div class="animal-name">Tiger</div>
          </div>
        </div>
        
        <p style="font-size: 0.875rem;">Sub-competencies tested: Breaking down information, Identifying patterns, Comparing sources, Finding assumptions, Drawing conclusions, Testing edge cases</p>
        
        <button class="start-btn" onclick="startGame()">Begin Assessment</button>
      </div>
    </div>
    
    <!-- SCENE 1: Elephant -->
    <div class="scene" id="scene1">
      <div class="scene-header">
        <div class="animal-badge" style="background: var(--elephant-blue);">üêò</div>
        <div class="scene-info">
          <h2>Scene 1: Elephant</h2>
          <div class="emotion">Empathy ‚Ä¢ Break complex information</div>
        </div>
      </div>
      
      <div class="scenario-card" style="border-color: var(--elephant-blue);">
        <h3>Scenario</h3>
        <p>Your teammate arrives late, avoids eye contact, and speaks softly.</p>
        <div class="cue-strip">
          <div class="color-badge" style="background: var(--elephant-blue);"></div>
          <span>üêò</span>
          <span class="phrase">"Understanding others requires seeing all the pieces"</span>
        </div>
      </div>
      
      <div class="task-card">
        <h4>Your Task</h4>
        <p>Break the situation into emotional components.</p>
      </div>
      
      <div class="choices" data-correct="1">
        <div class="choice" data-index="0">
          <span class="choice-letter">A</span>
          <span>Behavior = disrespect; Emotion = anger</span>
        </div>
        <div class="choice" data-index="1">
          <span class="choice-letter">B</span>
          <span>Behavior = discomfort; Emotion = fear</span>
        </div>
        <div class="choice" data-index="2">
          <span class="choice-letter">C</span>
          <span>Behavior = frustration; Emotion = annoyance</span>
        </div>
        <div class="choice" data-index="3">
          <span class="choice-letter">D</span>
          <span>Behavior = distraction; Emotion = apathy</span>
        </div>
      </div>
      
      <button class="submit-btn" onclick="submitAnswer(1)">Submit Answer</button>
    </div>
    
    <!-- SCENE 2: Dolphin -->
    <div class="scene" id="scene2">
      <div class="scene-header">
        <div class="animal-badge" style="background: var(--dolphin-yellow);">üê¨</div>
        <div class="scene-info">
          <h2>Scene 2: Dolphin</h2>
          <div class="emotion">Optimism ‚Ä¢ Identify patterns</div>
        </div>
      </div>
      
      <div class="scenario-card" style="border-color: var(--dolphin-yellow);">
        <h3>Scenario</h3>
        <p>You observe three colleagues over a week. Each one shows: a yellow band on their desk, dolphin imagery, and phrases about "looking forward" and "possibilities."</p>
        <div class="cue-strip">
          <div class="color-badge" style="background: var(--dolphin-yellow);"></div>
          <span>üê¨</span>
          <span class="phrase">"Joy rides the waves of possibility"</span>
        </div>
      </div>
      
      <div class="task-card">
        <h4>Your Task</h4>
        <p>Identify the emotional pattern these colleagues share.</p>
      </div>
      
      <div class="choices" data-correct="2">
        <div class="choice" data-index="0">
          <span class="choice-letter">A</span>
          <span>Empathy</span>
        </div>
        <div class="choice" data-index="1">
          <span class="choice-letter">B</span>
          <span>Courage</span>
        </div>
        <div class="choice" data-index="2">
          <span class="choice-letter">C</span>
          <span>Optimism</span>
        </div>
        <div class="choice" data-index="3">
          <span class="choice-letter">D</span>
          <span>Resilience</span>
        </div>
      </div>
      
      <button class="submit-btn" onclick="submitAnswer(2)">Submit Answer</button>
    </div>
    
    <!-- SCENE 3: Owl -->
    <div class="scene" id="scene3">
      <div class="scene-header">
        <div class="animal-badge" style="background: var(--owl-purple);">ü¶â</div>
        <div class="scene-info">
          <h2>Scene 3: Owl</h2>
          <div class="emotion">Insight ‚Ä¢ Compare sources</div>
        </div>
      </div>
      
      <div class="scenario-card" style="border-color: var(--owl-purple);">
        <h3>Scenario</h3>
        <p>A colleague tells you: "She's definitely angry at me." But you notice: a purple band, an owl symbol, and the phrase "See clearly in the dark" on her desk.</p>
        <div class="cue-strip">
          <div class="color-badge" style="background: var(--owl-purple);"></div>
          <span>ü¶â</span>
          <span class="phrase">"See clearly in the dark"</span>
        </div>
      </div>
      
      <div class="task-card">
        <h4>Your Task</h4>
        <p>Compare sources: which interpretation is more credible?</p>
      </div>
      
      <div class="choices" data-correct="1">
        <div class="choice" data-index="0">
          <span class="choice-letter">A</span>
          <span>The self-report ("She's angry")</span>
        </div>
        <div class="choice" data-index="1">
          <span class="choice-letter">B</span>
          <span>The emotional cues ‚Üí indicates self-doubt, not anger</span>
        </div>
        <div class="choice" data-index="2">
          <span class="choice-letter">C</span>
          <span>Both are equally valid</span>
        </div>
        <div class="choice" data-index="3">
          <span class="choice-letter">D</span>
          <span>Neither provides useful information</span>
        </div>
      </div>
      
      <button class="submit-btn" onclick="submitAnswer(3)">Submit Answer</button>
    </div>
    
    <!-- SCENE 4: Dog -->
    <div class="scene" id="scene4">
      <div class="scene-header">
        <div class="animal-badge" style="background: var(--dog-green);">üêï</div>
        <div class="scene-info">
          <h2>Scene 4: Dog</h2>
          <div class="emotion">Compassion ‚Ä¢ Find assumptions</div>
        </div>
      </div>
      
      <div class="scenario-card" style="border-color: var(--dog-green);">
        <h3>Scenario</h3>
        <p>You haven't heard from your friend all day. Your mind races with possibilities.</p>
        <div class="cue-strip">
          <div class="color-badge" style="background: var(--dog-green);"></div>
          <span>üêï</span>
          <span class="phrase">"Love heals"</span>
        </div>
      </div>
      
      <div class="task-card">
        <h4>Your Task</h4>
        <p>Which assumption leads to the wrong conclusion?</p>
      </div>
      
      <div class="choices" data-correct="0">
        <div class="choice" data-index="0">
          <span class="choice-letter">A</span>
          <span>"They must be mad at me."</span>
        </div>
        <div class="choice" data-index="1">
          <span class="choice-letter">B</span>
          <span>"They may be overwhelmed."</span>
        </div>
        <div class="choice" data-index="2">
          <span class="choice-letter">C</span>
          <span>"They may be tired."</span>
        </div>
        <div class="choice" data-index="3">
          <span class="choice-letter">D</span>
          <span>"They may be busy."</span>
        </div>
      </div>
      
      <button class="submit-btn" onclick="submitAnswer(4)">Submit Answer</button>
    </div>
    
    <!-- SCENE 5: Parrot -->
    <div class="scene" id="scene5">
      <div class="scene-header">
        <div class="animal-badge" style="background: var(--parrot-orange);">ü¶ú</div>
        <div class="scene-info">
          <h2>Scene 5: Parrot</h2>
          <div class="emotion">Speak Out ‚Ä¢ Draw conclusions</div>
        </div>
      </div>
      
      <div class="scenario-card" style="border-color: var(--parrot-orange);">
        <h3>Scenario</h3>
        <p>You have limited information. The only cues available are: an orange band, a parrot symbol, and the phrase below.</p>
        <div class="cue-strip">
          <div class="color-badge" style="background: var(--parrot-orange);"></div>
          <span>ü¶ú</span>
          <span class="phrase">"If something feels wrong, speak out"</span>
        </div>
      </div>
      
      <div class="task-card">
        <h4>Your Task</h4>
        <p>Draw a valid conclusion from this incomplete data.</p>
      </div>
      
      <div class="choices" data-correct="2">
        <div class="choice" data-index="0">
          <span class="choice-letter">A</span>
          <span>Stay quiet and observe more</span>
        </div>
        <div class="choice" data-index="1">
          <span class="choice-letter">B</span>
          <span>Someone is attacking you</span>
        </div>
        <div class="choice" data-index="2">
          <span class="choice-letter">C</span>
          <span>You need clear, assertive expression</span>
        </div>
        <div class="choice" data-index="3">
          <span class="choice-letter">D</span>
          <span>Focus on comforting someone else</span>
        </div>
      </div>
      
      <button class="submit-btn" onclick="submitAnswer(5)">Submit Answer</button>
    </div>
    
    <!-- SCENE 6: Tiger -->
    <div class="scene" id="scene6">
      <div class="scene-header">
        <div class="animal-badge" style="background: var(--tiger-black);">üêØ</div>
        <div class="scene-info">
          <h2>Scene 6: Tiger</h2>
          <div class="emotion">Courage ‚Ä¢ Test edge cases</div>
        </div>
      </div>
      
      <div class="scenario-card" style="border-color: var(--tiger-black);">
        <h3>Scenario</h3>
        <p>You need to speak up about an issue. BUT: the room is tense, emotions are high, and timing feels risky.</p>
        <div class="cue-strip">
          <div class="color-badge" style="background: var(--tiger-black);"></div>
          <span>üêØ</span>
          <span class="phrase">"Courage with boundaries"</span>
        </div>
      </div>
      
      <div class="task-card">
        <h4>Your Task</h4>
        <p>Given these constraints, what's the correct action?</p>
      </div>
      
      <div class="choices" data-correct="2">
        <div class="choice" data-index="0">
          <span class="choice-letter">A</span>
          <span>Speak aggressively to be heard</span>
        </div>
        <div class="choice" data-index="1">
          <span class="choice-letter">B</span>
          <span>Stay completely silent</span>
        </div>
        <div class="choice" data-index="2">
          <span class="choice-letter">C</span>
          <span>Use courage with respectful boundaries</span>
        </div>
        <div class="choice" data-index="3">
          <span class="choice-letter">D</span>
          <span>Shift to empathy and avoid the topic</span>
        </div>
      </div>
      
      <button class="submit-btn" onclick="submitAnswer(6)">Submit Answer</button>
    </div>
    
    <!-- RESULTS SCREEN -->
    <div class="scene" id="results">
      <div class="results-screen">
        <div class="results-icon" id="resultsIcon">üèÜ</div>
        <h2>Assessment Complete</h2>
        <div class="proficiency-badge" id="proficiencyBadge">Proficient</div>
        
        <div class="score-card">
          <div class="score-value" id="scoreValue">83%</div>
          <div class="score-label">Overall Score</div>
        </div>
        
        <div class="sub-results" id="subResults">
          <!-- Populated by JS -->
        </div>
        
        <div class="xp-badge" id="xpBadge">
          <span>‚ö°</span>
          <span id="xpValue">+150 XP</span>
        </div>
        
        <button class="restart-btn" onclick="restartGame()">Try Again</button>
      </div>
    </div>
  </div>
  
  <!-- Feedback Modal -->
  <div class="feedback-modal" id="feedbackModal">
    <div class="feedback-content">
      <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
      <h3 id="feedbackTitle">Correct!</h3>
      <p id="feedbackText">You correctly identified the emotional components.</p>
      <button class="next-btn" onclick="nextScene()">Continue</button>
    </div>
  </div>

  <script>
    // Game State
    let currentScene = 0;
    let answers = [];
    let timeLeft = 180; // 3 minutes
    let timerInterval = null;
    let startTime = null;
    
    const scenes = [
      { animal: 'üêò', name: 'Elephant', emotion: 'Empathy', sub: 'Break complex information' },
      { animal: 'üê¨', name: 'Dolphin', emotion: 'Optimism', sub: 'Identify patterns' },
      { animal: 'ü¶â', name: 'Owl', emotion: 'Insight', sub: 'Compare sources' },
      { animal: 'üêï', name: 'Dog', emotion: 'Compassion', sub: 'Find assumptions' },
      { animal: 'ü¶ú', name: 'Parrot', emotion: 'Speak Out', sub: 'Draw conclusions' },
      { animal: 'üêØ', name: 'Tiger', emotion: 'Courage', sub: 'Test edge cases' }
    ];
    
    // Initialize choice listeners
    document.querySelectorAll('.choices').forEach(choiceContainer => {
      choiceContainer.querySelectorAll('.choice').forEach(choice => {
        choice.addEventListener('click', () => selectChoice(choice, choiceContainer));
      });
    });
    
    function selectChoice(choice, container) {
      container.querySelectorAll('.choice').forEach(c => c.classList.remove('selected'));
      choice.classList.add('selected');
      container.closest('.scene').querySelector('.submit-btn').classList.add('active');
    }
    
    function startGame() {
      currentScene = 1;
      answers = [];
      startTime = Date.now();
      
      document.getElementById('intro').classList.remove('active');
      document.getElementById('scene1').classList.add('active');
      document.getElementById('header').style.display = 'flex';
      document.getElementById('progressBar').style.display = 'block';
      
      updateProgress();
      startTimer();
    }
    
    function startTimer() {
      timeLeft = 180;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          finishGame();
        }
      }, 1000);
    }
    
    function updateTimerDisplay() {
      const mins = Math.floor(timeLeft / 60);
      const secs = timeLeft % 60;
      document.getElementById('timer').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    function updateProgress() {
      const progress = ((currentScene - 1) / 6) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('currentScene').textContent = currentScene;
    }
    
    function submitAnswer(sceneNum) {
      const sceneEl = document.getElementById('scene' + sceneNum);
      const choiceContainer = sceneEl.querySelector('.choices');
      const selectedChoice = choiceContainer.querySelector('.choice.selected');
      
      if (!selectedChoice) return;
      
      const selectedIndex = parseInt(selectedChoice.dataset.index);
      const correctIndex = parseInt(choiceContainer.dataset.correct);
      const isCorrect = selectedIndex === correctIndex;
      
      answers.push({
        scene: sceneNum,
        selected: selectedIndex,
        correct: correctIndex,
        isCorrect: isCorrect
      });
      
      // Show visual feedback on choices
      choiceContainer.querySelectorAll('.choice').forEach(c => {
        const idx = parseInt(c.dataset.index);
        if (idx === correctIndex) c.classList.add('correct');
        else if (idx === selectedIndex && !isCorrect) c.classList.add('incorrect');
      });
      
      // Show feedback modal
      const modal = document.getElementById('feedbackModal');
      const icon = document.getElementById('feedbackIcon');
      const title = document.getElementById('feedbackTitle');
      const text = document.getElementById('feedbackText');
      
      if (isCorrect) {
        icon.textContent = '‚úÖ';
        title.textContent = 'Correct!';
        text.textContent = `Great job! The ${scenes[sceneNum-1].animal} ${scenes[sceneNum-1].name} guides you to ${scenes[sceneNum-1].emotion.toLowerCase()}.`;
      } else {
        icon.textContent = '‚ùå';
        title.textContent = 'Not Quite';
        text.textContent = `The ${scenes[sceneNum-1].animal} ${scenes[sceneNum-1].name} represents ${scenes[sceneNum-1].emotion}. Review the cues and try again next time.`;
      }
      
      modal.classList.add('show');
    }
    
    function nextScene() {
      document.getElementById('feedbackModal').classList.remove('show');
      
      // Hide current scene
      document.getElementById('scene' + currentScene).classList.remove('active');
      
      currentScene++;
      
      if (currentScene > 6) {
        finishGame();
      } else {
        document.getElementById('scene' + currentScene).classList.add('active');
        updateProgress();
      }
    }
    
    function finishGame() {
      clearInterval(timerInterval);
      
      // Hide all scenes
      document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
      document.getElementById('header').style.display = 'none';
      document.getElementById('progressBar').style.display = 'none';
      
      // Calculate results
      const correctCount = answers.filter(a => a.isCorrect).length;
      const score = Math.round((correctCount / 6) * 100);
      const timeSpent = Math.round((Date.now() - startTime) / 1000);
      
      // Determine proficiency
      let level, xp, icon;
      if (score >= 90) {
        level = 'Mastery';
        xp = 200;
        icon = 'üèÜ';
      } else if (score >= 70) {
        level = 'Proficient';
        xp = 150;
        icon = '‚≠ê';
      } else {
        level = 'Needs Work';
        xp = 50;
        icon = 'üìö';
      }
      
      // Update results UI
      document.getElementById('resultsIcon').textContent = icon;
      document.getElementById('scoreValue').textContent = score + '%';
      document.getElementById('xpValue').textContent = '+' + xp + ' XP';
      
      const badge = document.getElementById('proficiencyBadge');
      badge.textContent = level;
      badge.className = 'proficiency-badge ' + level.toLowerCase().replace(' ', '-');
      
      // Build sub-results
      const subResults = document.getElementById('subResults');
      subResults.innerHTML = scenes.map((scene, idx) => {
        const answer = answers[idx];
        const status = answer && answer.isCorrect ? '‚úÖ' : '‚ùå';
        return `
          <div class="sub-result">
            <span class="emoji">${scene.animal}</span>
            <span class="name">${scene.name}: ${scene.sub}</span>
            <span class="status">${status}</span>
          </div>
        `;
      }).join('');
      
      // Show results
      document.getElementById('results').classList.add('active');
      
      // Emit results for parent iframe
      window.__RESULT__ = {
        score: score,
        level: level === 'Mastery' ? 3 : level === 'Proficient' ? 2 : 1,
        xp: xp,
        passed: score >= 70,
        timeSpent: timeSpent
      };
      
      window.__PROOF__ = {
        answers: answers,
        timestamp: new Date().toISOString()
      };
      
      // Notify parent if in iframe
      if (window.parent !== window) {
        window.parent.postMessage({ type: 'GAME_COMPLETE', result: window.__RESULT__, proof: window.__PROOF__ }, '*');
      }
    }
    
    function restartGame() {
      // Reset all choices
      document.querySelectorAll('.choice').forEach(c => {
        c.classList.remove('selected', 'correct', 'incorrect');
      });
      document.querySelectorAll('.submit-btn').forEach(b => b.classList.remove('active'));
      
      // Show intro
      document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
      document.getElementById('intro').classList.add('active');
      
      currentScene = 0;
      answers = [];
    }
    
    // Signal ready
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'GAME_READY' }, '*');
    }
  </script>
</body>
</html>
